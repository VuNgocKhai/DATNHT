<!DOCTYPE html>
<html th:fragment="dynamic(main)" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/images/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/assets/lib/animate/animate.min.css" rel="stylesheet">
    <link href="/assets/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/assets/css/style2.css" rel="stylesheet">
</head>
<body>
<div th:replace="/layout/header.html"></div>
<div th:replace="${main}"></div>
<div th:replace="/layout/footer.html"></div>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
<script src="/assets/lib/easing/easing.min.js"></script>
<script src="/assets/lib/owlcarousel/owl.carousel.min.js"></script>

<!-- Contact Javascript File -->
<script src="/assets/mail/jqBootstrapValidation.min.js"></script>
<script src="/assets/mail/contact.js"></script>

<!-- Template Javascript -->
<script src="/assets/js/main2.js"></script>
<script>
    // 1. what is API
    // 2. How do I call API
    // 3. Explain code
    const host = "https://provinces.open-api.vn/api/";
    var callAPI = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data, "province");
            });
    }
    callAPI('https://provinces.open-api.vn/api/?depth=1');
    var callApiDistrict = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data.districts, "district");
            });
    }
    var callApiWard = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data.wards, "ward");
            });
    }

    var renderData = (array, select) => {
        let row = ' <option disable value="">chọn</option>';

        array.forEach(element => {
            row += `<option value="${element.name}" data-code="${element.code}">${element.name}</option>`
        });
        document.querySelector("#" + select).innerHTML = row
    }

    $("#province").change(() => {
        const selectedCode = $("#province option:selected").data("code");
        callApiDistrict(host + "p/" + selectedCode + "?depth=2");
        printResult();
    });
    $("#district").change(() => {
        const selectedCode = $("#district option:selected").data("code");
        callApiWard(host + "d/" + selectedCode + "?depth=2");
        printResult();
    });
    $("#ward").change(() => {
        printResult();
    })

    var printResult = () => {
        if ($("#district").val() != "" && $("#province").val() != "" &&
            $("#ward").val() != "") {
            let result = $("#province option:selected").text() +
                " | " + $("#district option:selected").text() + " | " +
                $("#ward option:selected").text();
            $("#result").text(result)
        }

    }
    function callAPIGHN() {
        var thanhPho= $("#province option:selected").text();
        var huyen= $("#district option:selected").text();
        var xa= $("#ward option:selected").text();
        $.ajax({
            type: "POST",
            url: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/create" , // Đường dẫn của bạn để lấy thông tin chi tiết
            headers: {
                'Token': '50ea92cd-6b53-11ee-a6e6-e60958111f48', // Thay thế YOUR_API_TOKEN_HERE bằng token của bạn
                'Content-Type': 'application/json',
                'ShopId': '189834 - 0385090080'
            },
            data: JSON.stringify({
                "payment_type_id": 2,
                "note": "Tintest 123",
                "required_note": "KHONGCHOXEMHANG",
                "return_phone": "0332190158",
                "return_address": "39 NTT",
                "return_district_id": null,
                "return_ward_code": "",
                "client_order_code": "",
                "from_name": "TinTest124",
                "from_phone": "0987654321",
                "from_address": "Hà Nội, Vietnam",
                "from_ward_name": "Cấn Hữu",
                "from_district_name": "Quốc Oai",
                "from_province_name": "Hà Nội",
                "to_name": "TinTest124",
                "to_phone": "0987654321",
                "to_address": "72 Thành Thái, Phường 14, Quận 10, Hồ Chí Minh, Vietnam",
                "to_ward_name": xa,
                "to_district_name": huyen,
                "to_province_name": thanhPho,
                "cod_amount": 200000,
                "content": "Theo New York Times",
                "weight": 2000,
                "length": 1,
                "width": 19,
                "height": 10,
                "cod_failed_amount": 2000,
                "pick_station_id": 1444,
                "deliver_station_id": null,
                "insurance_value": 10000000,
                "service_id": 0,
                "service_type_id":2,
                "coupon":null,
                "pickup_time":1692840132,
                "pick_shift":[2]
            }),
            success: function(response) {
                // Giả sử phản hồi trả về là một đối tượng JSON với các thuộc tính như ma, hoTen,...
                console.log("Thành Công");
                console.log("xa:"+xa);
                console.log("huyen"+huyen);
                console.log("thanh pho:"+thanhPho);
                document.getElementById('phiShip').innerText = response.data.total_fee;
            },
            error: function(error) {
                console.log(error);
                alert("Lỗi khi lấy thông tin nhân viên");
            }
        });
    }
</script>
</body>
</html>